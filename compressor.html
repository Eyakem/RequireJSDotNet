<!DOCTYPE html>
<html lang="en">

<head>
	
    <meta charset="utf-8">

	<title>RequireJS.NET - Bundling</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ASP.NET MVC JavaScript bundling and minification with RequireJS.NET Compressor">
    <meta name="keywords" content="requirejs, javascript, asp.net, compression, js bundling, i18n">
	<meta name="author" content="VeriTech">
	
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="@vtfuture">
	<meta name="twitter:creator" content="@vtfuture">
	<meta name="twitter:title" content="RequireJS.NET">
	<meta name="twitter:description" content="RequireJS for .NET brings asynchronous JavaScript loading and flexible js bundling configuration to ASP.NET MVC projects.">
	<meta name="twitter:image:src" content="http://requirejsnet.veritech.io/img/require-128x128.png">
	
	<meta property="og:locale" content="en_US" />
	<meta property="og:title" content="RequireJS.NET" />
	<meta property="og:url" content="http://requirejsnet.veritech.io/" />
	<meta property="og:image" content="http://requirejsnet.veritech.io/img/require-logo.png" />
	<meta property="og:type" content="website" />
	
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

	<link rel="shortcut icon" href="img/favicon.png">
	<link rel="icon" type="image/png" href="img/favicon.png" />

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="css/site.css" rel="stylesheet">

</head>

<body class="secondary">
	
	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header" data-scroll-header="">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://requirejsnet.veritech.io"><img src="img/require-logo.png" alt="RequireJS.NET" width="136" height="51"></a>
            </div>

            <div class="collapse navbar-collapse navbar-right navbar-ex1-collapse">
                <ul class="nav navbar-nav">
					<li><a href="index.html">Home</a>
                    </li>
                    <li><a href="setup.html">Setup</a>
                    </li>
                    <li class="active"><a href="compressor.html">Bundling</a>
                    </li>
					<li><a href="i18n.html">i18n</a>
                    </li>
	            </ul>
            </div>
        </div>
    </nav>
	
	<div class="feature">
		<div class="container secondary">
			<h1>
				Bundling and minification using <strong>RequireJS.NET Compressor</strong>
			</h1>
		</div>
		
	</div>
	
	<div class="site-content">
		<div class="container">		
					
			<h5>Download</h5>
			<p>
				To install RequireJS.NET Compressor, run the following command in the Package Manager Console: <br/><kbd>PM> Install-Package RequireJsNet.Compressor</kbd>
			</p>
			
			<h5>Introduction</h5>
			<p>
				Script concatenation and minification is realized by processing the input (related to bundles) you provide through the config and establishing what files should and should not be in a bundle.
			</p>
			<p>
				Using the classical compressor means that you also have to provide a manual override of all the paths included in bundles so that require.js can load the right version.
			</p>
			<p>
				Using the autoCompressor, you only have to point it to your application's entry point(s) (easily done using a folder, generally <code>~/Scripts/Controllers/</code>). It will detect most types of require and define calls by parsing your javascript and generating a tree to determine what the right scripts are for that bundle. In some cases, static analysis might not be enough to determine what module you're trying to load (for example, doing something like <code>require(['jquery-' + lang]))</code>, so you can control what scripts go in your bundle using the exclude/include properties of the <code>autoBundle</code>.
			</p>
			<p>
				The auto compressor will also generate proper require modules out of your shimmed script, whereas with the classic compressor you had to do that manually.
			</p>
			<p>
				In order to know what files to load at runtime, the autoCompressor will automatically generate another configuration file that will be able to tell us at runtime what bundle should be loaded when. To find them, assuming your configuration file is named <code>RequireJS.json</code>, after a build using the autoCompressor you should find a file named <code>RequireJS.override.json</code>. You can also look at this file to debug possible dependency tree generation issues.
			</p>
			<p>
				You have to keep in mind that if you've set the <code>LoadOverrides</code> property to true when rendering the require config, if an overload file is present, it will be loaded. If you're trying out the autoCompressor locally, you might want to set that property to false when in debug configuration, for example.
			</p>
			
			<h5>Auto Compressor Bundling configuration</h5>
			<p>
				Having a bundle for each MVC area in your project is probably the best approach if your JavaScript code has different dependencies per area. 
				For example, if you are developing a CMS site, the Admin area certainly uses more JS components (WYSIWYG editor, file upload, etc) than the Public area, so it's logical to include in the Public bundle only the JS components referenced by the code-behind code of the pages that compose the Public area.  
			</p>
			<p>
				Bundling per area example:
			</p>
			<pre class="prettyprint lang-js">
{
    "paths": {
        "jquery": "jquery-1.10.2",
        "jquery-validate": "jquery.validate",
        "jquery-validate-unobtrusive": "jquery.validate.unobtrusive",
        "bootstrap": "bootstrap",
        "file-upload": "jquery.fileupload",
        "html-editor": "tinymce"
    },
    "shim": {
        "jquery-validate": {
            "deps": [ "jquery" ]
        },
        "jquery-validate-unobtrusive": {
            "deps": [ "jquery", "jquery-validate" ]
        },
        "bootstrap": {
            "deps": [ "jquery" ]
        },
        "file-upload": {
            "deps": [ "jquery" ]
        },
        "html-editor": { 
            "deps":  ["jquery"]
        }
    },
    "autoBundles": {
        "public-app": {
            "outputPath": "Scripts/Bundles/",
            "include": [
                {
                    "directory": "Controllers/Root"
                }
            ]
        },
        "admin-app": {
            "outputPath": "Scripts/Bundles/",
            "include": [
                {
                    "directory": "Controllers/Admin"
                }
            ]
        }
    }
}</pre>
			<p>
				The above configuration will generate two files in <code>~Scripts/Bundles</code>, public-app.js and admin-app.js, if the modules from <code>~Scripts/Controllers/Root</code> does not require the file-upload or html-editor then these components will be bundled only in the admin-app.js file.
			</p>
			
			<h5>Run compressor from Visual Studio at build</h5>
			<p>
				By default when you install the Compressor package any <code>RequireJS.json</code> files with be assigned to <code>RequireJsNetConfig</code> build action and will trigger the compressor task at build. After each build it will create a folder named <code>bundle</code>
				 inside Scripts where all your defined bundles will be compiled. 
			</p>
			<p>
				If you have multiple config files that you want to compile then you need to set for each one the build action to <code>RequireJsNetConfig</code> like this:
			</p>
			<img class="site-img" src="img/rjs-build-action.png"/>
			
			
			<h5>Run compressor from MsBuild on a build server</h5>
			<p>
				For the bundling to take place at build, create a folder named <code>.build</code> in your ASP.NET project root and add a file named <code>Compressor.targets</code> with the following content: 
			</p>
			<pre class="prettyprint lang-xml">&lt;Project xmlns=&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;&gt;
  &lt;UsingTask TaskName=&quot;RequireCompressorTask&quot; AssemblyFile=&quot;...\packages\RequireJsNet.Compressor.2.2.3\tools\RequireJsNet.Compressor.dll&quot; /&gt;
  &lt;ItemGroup&gt;
    &lt;Configs Include=&quot;$(_PackageTempDir)\RequireJS.json&quot; /&gt;
    &lt;Content Include=&quot;RequireJS.json&quot;&gt;
      &lt;Visible&gt;false&lt;/Visible&gt;
    &lt;/Content&gt;
  &lt;/ItemGroup&gt;
  &lt;Target Name=&quot;RequireJsNetCompressor&quot; AfterTargets=&quot;CopyAllFilesToSingleFolderForMsdeploy&quot;&gt;
    &lt;RequireCompressorTask 
      LoggingType=&quot;Debug&quot; 
      RequireConfigs=&quot;@(Configs)&quot; 
      AutoCompressor=&quot;true&quot; 
      EncodingType=&quot;UTF8&quot; 
      ProjectPath=&quot;$(_PackageTempDir)&quot; 
      PackagePath=&quot;$(_PackageTempDir)\Scripts\&quot; /&gt;
  &lt;/Target&gt;
&lt;/Project&gt;</pre>
			<p>The RequireCompressorTask can receive the following paramters:</p>
			<p>
			<strong>LoggingType</strong> - to be passed to the YUI compressor, can be <code>none</code>, <code>info</code> or <code>debug</code>
			</p>
			<p>
			<strong>CompressionType</strong> - to be passed to the YUI compressor, can be <code>none</code> or <code>standard</code>
			</p>
			<p>
			<strong>EncodingType</strong> - to be passed to the YUI compressor, text encoding for the minifier, can have one of the following values: <code>ascii, bigendianunicode, unicode, utf32, utf-32, utf7, utf-7, utf8, utf-8, default</code>
			</p>
			<p>
			<strong>AutoCompressor</strong> - whether to run the autoCompressor or the classic one
			</p>
			<p>
			<strong>PackagePath</strong> - the output directory for packages, it will default to the value of <code>ProjectPath</code> if not specified.
			</p>
			<p>
			<strong>ProjectPath</strong> - the directory from which configs/scripts are read
			</p>
			<p>
			<strong>RequireConfigs</strong> - the list of require configuration files. Defaults to <code>~/RequireJS.json</code>
			</p>
			<p>
			<strong>EntryPointOverride</strong> - allows you to override the entrypoint used to load scripts, default is <code>ProjectPath + \Scripts\</code>
			</p>
			<p>Add the following line at the end of your .csproj to import the Compressor targets:</p>
			<pre class="prettyprint lang-xml">&lt;Import Project=&quot;.build\Compressor.targets&quot; /&gt;</pre>
			
			<p>On your build server you will want to avoid running the `RequireJsNetConfig` build action for each file if you will use the above code, in order to disable the build action set the following MsBuild parameter: <code>/P:RequireJsNetCompressorRun=False</code></p>
			
			<p>When you build or deploy the MVC project, three files will be generated: the two bundles and <code>RequireJS.override.json</code>. Because these files will be generated on each build, there is no need to keep them on the source repository, in order to exclude them from git you can add the following lines to <code>.gitignore</code> file.</p>
			<pre class="prettyprint">
# Exclude RequireJS.NET Compressor build files
*.override.config
*.override.json
*/Scripts/Bundles/</pre>
			
			<h5>Load bundles</h5>
			<p>
				In order to load the bundles made by the Compressor you'll have to set the RequireRendererConfiguration.LoadOverrides property as true, normally you'll want this to happen on the production environment, for this you can use the HttpContext.Current.IsDebuggingEnabled flag like this: 
			</p>
			<pre class="prettyprint lang-cs">
@Html.RenderRequireJsSetup(new RequireRendererConfiguration
{
    RequireJsUrl = Url.Content("~/Scripts/Components/RequireJS/require.js"),
    BaseUrl = Url.Content("~/Scripts/"),
    ConfigurationFiles = new[] { "~/RequireJS.json" },
    EntryPointRoot = "~/Scripts/",
	
    // whether we should load overrides or not, used for autoBundles
    LoadOverrides = !HttpContext.Current.IsDebuggingEnabled
})</pre>
			<h5>More info</h5>
			<p>For more information on RequireJS.NET Compressor features please read the <a href="https://github.com/vtfuture/RequireJSDotNet/wiki" target="_blank" rel="nofollow">wiki</a> and try out the <a href="https://github.com/vtfuture/RequireJSDotNet/" target="_blank" rel="nofollow">demo projects</a>. If you have suggestion or any kind of feedback regarding RequireJS.NET project please submit an issue <a href="https://github.com/vtfuture/RequireJSDotNet/issues" target="_blank" rel="nofollow">here</a>.</p>
		</div>		
	</div>
	
		
	</div>
	
	<div class="footer" id="contact">	
		<div class="container">			
			<p class="pull-left">2014 © VeriTech.io <br />All Rights Reserved</p>
			<a class="pull-right" href="http://veritech.io"><img src="img/veritech-logo-site@2x.png" alt="VeriTech" width="63" height="40"></a>
		</div>		
	</div>
	
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/smoothscroll.min.js"></script>
	<script src="js/smooth-scroll.min.js"></script>
	<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
	
	<script type="text/javascript">
		jQuery(function () {			  			  
			  //Scroll
			  smoothScroll.init();					    
		});		
	</script>
	 <script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-53462137-3', 'auto');
	  ga('send', 'pageview');
	</script>
</body>

</html>
